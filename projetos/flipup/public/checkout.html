<!DOCTYPE html>
<html lang="en">
<head>
    <title>Checkout</title>
    </head>
<body>
    <button id="pay">Pagar</button>
    <input type="email" id="email" placeholder="Enter your email" required>
      <button id="check-subscription-btn">Check Subscription</button>
    <script src="https://js.stripe.com/v3/"></script>
    <!-- <script>
        var stripe = Stripe('pk_test_51PL7unI3KN8Sdb14bDtuu9RoLxaeVHvR8Pnt2R10UPfYQaNEb3D1VYnT0LugSSYnIvvum28Tr3q3PzVoKskP2pyX00KWy0C3m6');
        setTimeout(async() => {
            console.log(stripe);
            
            console.log("Listed customers");
            console.log(stripe.customers);
        }, 1000);
        document.getElementById("pay").addEventListener("click", function() {
            // var elements = stripe.elements();
            // var cardElement = elements.create('card');
            // cardElement.mount('#card-element');
            stripe.redirectToCheckout({
                lineItems: [
                    {
                        price: 'price_1PLBmLI3KN8Sdb14PdfBshdl',
                        quantity: 1
                    }
                ],
                mode: "subscription",
                customerEmail: "lucas@gmail.com",
                successUrl: "https://www.lucasfischer.com.br",
                cancelUrl: "http://www.x.com"
            }).then(function(result) {
                console.log(result);
            });
        })

    </script> -->
    <script>
        var stripe = Stripe('pk_test_51PL7unI3KN8Sdb14bDtuu9RoLxaeVHvR8Pnt2R10UPfYQaNEb3D1VYnT0LugSSYnIvvum28Tr3q3PzVoKskP2pyX00KWy0C3m6');
        async function checkSubscription(email) {
          try {
            const response = await fetch('https://api.stripe.com/v1/customers', {
              method: 'GET',
              headers: {
                'Authorization': 'Bearer sk_test_51PL7unI3KN8Sdb143kTGNotsZRj66t7ZKXxQTTRoiIYLQqSaYW7lT70E5Z4o9B1AQtcjseE99SeVoFaxxQKN75PL00ElO6GZeE',
                'Content-Type': 'application/json'
              }
            });
      
            const customers = await response.json();
            const customer = customers.data.find(customer => customer.email === email);
      
            if (!customer) {
              console.log('Customer not found');
              return;
            }
      
            const subscriptionsResponse = await fetch(`https://api.stripe.com/v1/subscriptions?customer=${customer.id}`, {
              method: 'GET',
              headers: {
                'Authorization': 'Bearer sk_test_51PL7unI3KN8Sdb143kTGNotsZRj66t7ZKXxQTTRoiIYLQqSaYW7lT70E5Z4o9B1AQtcjseE99SeVoFaxxQKN75PL00ElO6GZeE',
                'Content-Type': 'application/json'
              }
            });
      
            const subscriptions = await subscriptionsResponse.json();
            const activeSubscription = subscriptions.data.find(subscription => subscription.status === 'active');
      
            if (activeSubscription) {
              console.log('User has an active subscription:', activeSubscription);
            } else {
              console.log('User does not have an active subscription');
            }
          } catch (error) {
            console.error('Error checking subscription:', error);
          }
        }
      
        document.getElementById('check-subscription-btn').addEventListener('click', () => {
          const email = document.getElementById('email').value;
          checkSubscription(email);
        });
      </script>
      
      
</body>
</html>